!function($){$.fn.images=function(){return this.each(function(){function e(){if(t.data("limit")){var e=t.data("limit"),i=t.find(".images-item.selected").length;t.find(".images-limit").html("("+i+"/"+e+")"),i>=e?t.addClass("limit-reached"):t.removeClass("limit-reached")}}function i(){t.find(".add").removeClass("over"),t.find(".images-item").removeClass("over")}function a(){t.find(".images-item.selected").length?t.find(".imagesgrid").addClass("filled"):t.find(".imagesgrid").removeClass("filled"),t.find(".images-dropdown").removeClass("open"),t.find(".images-add-button").removeClass("open"),t.find(".images-dropdown a").not(".disabled").length>0?t.find(".images-dropdown .no-more-images").removeClass("da"):t.find(".images-dropdown .no-more-images").addClass("da"),e()}function d(){t.find("input.images").val("").trigger("change"),t.find(".images-item.selected").length>1?(filenames=new Array,t.find(".images-item.selected").each(function(){filenames.push($(this).data("image"))}),filenames="- "+filenames.join("\n- "),t.find("input.images").val(filenames).trigger("change")):t.find("input.images").val(t.find(".images-item.selected").data("image")).trigger("change"),t.closest("form").trigger("keep")}function s(e){t.find(".images-item[data-image='"+e+"']").insertBefore(t.find(".add")).addClass("selected"),t.find(".images-dropdown a[data-filename='"+e+"']").addClass("disabled"),a(),d(),i()}function n(e){t.find(".images-item[data-image='"+e+"']").removeClass("selected"),t.find(".images-dropdown a[data-filename='"+e+"']").removeClass("disabled"),a(),i(),d()}var t=$(this),o="images";if(t.data("images"))return!0;t.data("images",!0),t.find("input.filter").on("input change",function(){filter=$(this).val(),t.find(".images-dropdown .no-images-found").removeClass("da"),""!=filter?($.expr[":"].Contains=function(e,i,a){return $(e).text().toUpperCase().indexOf(a[3].toUpperCase())>=0},t.find(".images-dropdown a").addClass("filtered"),t.find(".images-dropdown a .image:Contains('"+filter+"')").not("disabled").closest("a").removeClass("filtered"),0===t.find(".images-dropdown a").not(".filtered").length&&t.find(".images-dropdown .no-images-found").addClass("da")):t.find(".images-dropdown a").removeClass("filtered")}),t.find("input.filter").keydown(function(e){if(38==e.keyCode&&(t.find(".images-dropdown a.focused").length?t.find(".images-dropdown a.focused").removeClass("focused").prevAll("a").not(".filtered").not(".disabled").first().addClass("focused"):(t.find(".images-dropdown a").removeClass("focused"),t.find(".images-dropdown a").not(".filtered").not(".disabled").last().addClass("focused"))),40==e.keyCode&&(t.find(".images-dropdown a.focused").length?t.find(".images-dropdown a.focused").removeClass("focused").nextAll("a").not(".filtered").not(".disabled").first().addClass("focused"):(t.find(".images-dropdown a").removeClass("focused"),t.find(".images-dropdown a").not(".filtered").not(".disabled").first().addClass("focused"))),13==e.keyCode)return t.find(".images-dropdown a.focused").click(),t.find(".images-dropdown a").removeClass("focused"),!1}),e(),a(),t.find(".images-item .btn.remove").on("click",function(){if(!$(this).is(".ui-sortable-helper .btn")){n($(this).closest(".images-item").data("image"))}return!1}),t.find(".images-add-button").on("click",function(e){e.stopPropagation(),t.find(".images-dropdown").toggleClass("open"),t.find(".images-add-button").toggleClass("open"),t.find("input.filter").focus(),$(document).click(function(e){0===$(e.target).closest(".images-dropdown").length&&(t.find("input.filter").val(""),t.find("input.filter").trigger("change"),t.find("input.filter").blur(),t.find(".images-dropdown").removeClass("open"),t.find(".images-add-button").removeClass("open"))})}),t.find(".images-dropdown a").on("click",function(e){t.hasClass("limit-reached")||(t.find("input.filter").val(""),t.find("input.filter").trigger("change"),s($(this).find(".image").text()),t.find(".images-dropdown").removeClass("open"),t.find(".images-add-button").removeClass("open"))});var l=t.find(".imagesgrid"),r=l.find(".sortable"),f=l.find(".images-item"),m=l.data("api");r.find(".images-item").length>1&&r.sortable({tolerance:"pointer",revert:100,handle:"figure",items:".selected",update:function(){d()}}).disableSelection(),t.find(".field-content").droppable({tolerance:"pointer",hoverClass:"over",accept:function(e){return!!$(".sidebar").has(e).length||(!($(this).has(e).length||!e.hasClass("images-item"))||void 0)},drop:function(e,i){t.find(".add").removeClass("over"),t.find(".images-item").removeClass("over");var a=i.draggable.data("helper");t.hasClass("limit-reached")||(i.draggable.hasClass("images-item")&&(otherField=i.draggable.closest(".field-with-images"),otherField.find(".images-dropdown a[data-filename='"+a+"']").removeClass("disabled"),otherField.find(".selected").length<=2&&otherField.find(".imagesgrid").removeClass("filled"),i.draggable.removeClass("selected"),otherField.find("input.images").val(""),otherField.find(".images-item.selected").length>1?(filenames=new Array,otherField.find(".images-item.selected").each(function(){filenames.push($(this).data("image"))}),filenames="- "+filenames.join("\n- "),otherField.find("input.images").val(filenames)):otherField.find("input.images").val(otherField.find(".images-item.selected").data("image")),otherField.closest("form").trigger("keep")),s(a))},over:function(e,i){var a=t.find(".images-item[data-image='"+i.draggable.data("helper")+"']");if(t.hasClass("limit-reached"));else if(a.hasClass("selected"))a.addClass("over");else{var d=t.find(".images-item.selected figure");if(d.length)var s=d.height()-4;else{var n=t.find(".images-item").first();n.addClass("selected");var s=n.find("figure").height()-4;n.removeClass("selected")}t.find(".add .inner").height(s),t.find(".add").addClass("over")}t.find(".imagesgrid").addClass("filled")},out:function(e,d){i(),a()}})})}}(jQuery);